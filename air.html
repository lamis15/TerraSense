<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>TerraSense - Qualite de l'air</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/air.css" />
    <script>
      (function () {
        const ok = localStorage.getItem("terrasense-auth");
        if (!ok && window.location.pathname !== "/signin") {
          window.location.replace("/signin");
        }
      })();
    </script>
  </head>
      <body>
        <div class="page-bg" aria-hidden="true">
      <video class="bg-video" autoplay muted loop playsinline poster="/static/media/air.jpg">
        <source src="/static/media/air.mp4" type="video/mp4" />
      </video>
      <div class="page-overlay"></div>
    </div>
    <div class="page">
      <header>
        <div class="navbar">
          <div class="brand">
            <div class="brand-icon">
              <img src="/images-agricultures/logo.png" alt="Logo TerraSense" />
            </div>
            <div>
              <div class="brand-text-main">TerraSense</div>
              <div class="brand-text-sub">Intelligence pour la Terre</div>
            </div>
          </div>
          <nav class="nav-links">
            <a href="/home" class="nav-link">Home</a>
            <a href="/agriculture" class="nav-link">Agriculture</a>
            <a href="/air" class="nav-link">Air</a>
            <a href="/water" class="nav-link">Water</a>
          </nav>
        </div>
      </header>

      <main>
        <section class="hero">
          <div class="hero-grid">
            <div class="hero-copy">
              <p class="eyebrow">Module air quality</p>
              <h1>
                Prediction du niveau de pollution
                <span>par les capteurs.</span>
              </h1>
              <p class="tagline">
                Saisissez les mesures issues des capteurs pour obtenir un niveau
                de qualite de l'air simple : Bas, Moyen ou Eleve.
              </p>
            </div>
            <div class="hero-visual air-video" aria-hidden="true">
              <video
                class="bg-video"
                autoplay
                muted
                loop
                playsinline
                poster="/static/media/air.jpg"
              >
                <source src="/static/media/air.mp4" type="video/mp4" />
              </video>
              <div class="video-overlay"></div>
              <div class="photo-sheen"></div>
              <div class="wind-line line-1"></div>
              <div class="wind-line line-2"></div>
              <div class="wind-line line-3"></div>
              <div class="wind-line line-4"></div>
              <div class="wind-line line-5"></div>
              <div class="wind-dots">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="layout">
            <div class="card" id="air-guide-card">
              <div class="pill">Guide des parametres</div>
              <div style="margin-top: 0.6rem; font-size: 0.86rem; color: var(--text-muted)">
                Avant de saisir vos donnees, parcourez ce petit guide pour comprendre
                a quoi sert chaque mesure.
              </div>

              <div class="wizard-steps">
                <div
                  class="wizard-step-indicator active"
                  id="air-indicator-step-1"
                ></div>
                <div class="wizard-step-indicator" id="air-indicator-step-2"></div>
                <div class="wizard-step-indicator" id="air-indicator-step-3"></div>
              </div>
              <div class="wizard-labels">
                <span>Capteurs CO/NMHC</span>
                <span>NOx & O3</span>
                <span>Resume</span>
              </div>

              <div class="wizard-step active" data-step="1">
                <h3 style="margin: 0 0 0.4rem; font-size: 1rem">
                  1. Capteurs primaires (CO, NMHC, C6H6)
                </h3>
                <ul
                  style="
                    padding-left: 1.1rem;
                    margin: 0.3rem 0;
                    font-size: 0.86rem;
                    color: var(--text-muted);
                  "
                >
                  <li><strong>PT08.S1(CO)</strong> : trace le monoxyde de carbone.</li>
                  <li><strong>NMHC(GT)</strong> et <strong>C6H6(GT)</strong> : hydrocarbures.</li>
                  <li><strong>PT08.S2(NMHC)</strong> : capteur associe aux NMHC.</li>
                </ul>

                <div class="mini-illustration">
                  <img
                    class="guide-image"
                    src="/static/media/home-env.jpg"
                    alt="Paysage representant la qualite de l'air"
                  />
                  <div class="mini-illustration-text">
                    Illustration d'un <strong>environnement a ciel ouvert</strong> pour visualiser la qualite de l'air.
                  </div>
                </div>

                <div class="wizard-actions">
                  <span class="hint">Etape 1/3 - Mesures de base.</span>
                  <button type="button" class="btn-primary" id="air-next-step-1">
                    Suivant
                  </button>
                </div>
              </div>

              <div class="wizard-step" data-step="2">
                <h3 style="margin: 0 0 0.4rem; font-size: 1rem">
                  2. Oxydes d'azote et ozone
                </h3>
                <ul
                  style="
                    padding-left: 1.1rem;
                    margin: 0.3rem 0;
                    font-size: 0.86rem;
                    color: var(--text-muted);
                  "
                >
                  <li><strong>NOx(GT)</strong> et <strong>NO2(GT)</strong> : pollution automobile.</li>
                  <li><strong>PT08.S3(NOx)</strong> et <strong>PT08.S4(NO2)</strong> : capteurs relies.</li>
                  <li><strong>PT08.S5(O3)</strong> : ozone et photochimie.</li>
                </ul>

                <div class="mini-illustration">
                  <img
                    class="guide-image"
                    src="/static/media/home-env.jpg"
                    alt="Qualite de l'air en milieu naturel"
                  />
                  <div class="mini-illustration-text">
                    Illustration d'un <strong>milieu naturel</strong> pour comprendre NOx et O3.
                  </div>
                </div>

                <div class="wizard-actions">
                  <button type="button" class="btn-secondary" id="air-prev-step-2">
                    Retour
                  </button>
                  <button type="button" class="btn-primary" id="air-next-step-2">
                    Suivant
                  </button>
                </div>
              </div>

              <div class="wizard-step" data-step="3">
                <h3 style="margin: 0 0 0.4rem; font-size: 1rem">
                  3. Vue d'ensemble
                </h3>
                <div
                  style="
                    font-size: 0.86rem;
                    color: var(--text-muted);
                    margin-bottom: 0.6rem;
                  "
                >
                  Le modele combine toutes les mesures pour classer le niveau de
                  pollution en <strong>Bas</strong>, <strong>Moyen</strong> ou <strong>Eleve</strong>.
                </div>

                <div class="mini-illustration">
                  <img
                    class="guide-image"
                    src="/static/media/home-env.jpg"
                    alt="Vue d'ensemble de la qualite de l'air"
                  />
                  <div class="mini-illustration-text">
                    Synthese des <strong>indicateurs combines</strong> pour la decision finale.
                  </div>
                </div>

                <div class="wizard-actions">
                  <button type="button" class="btn-secondary" id="air-prev-step-3">
                    Retour
                  </button>
                  <button
                    type="button"
                    class="btn-primary"
                    id="air-show-form-button"
                  >
                    Passer a la saisie des mesures
                  </button>
                </div>
              </div>
            </div>

            <div class="card" id="air-form-card" style="margin-top: 1.8rem; display: none">
              <div class="pill">Saisie des mesures</div>
              <form id="air-form" class="form-grid" style="margin-top: 1.3rem">
                <div class="field">
                  <label for="PT08.S1(CO)">PT08.S1(CO)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="PT08.S1(CO)"
                    name="PT08.S1(CO)"
                    required
                  />
                  <span>Capteur 1 lie au monoxyde de carbone</span>
                </div>

                <div class="field">
                  <label for="NMHC(GT)">NMHC(GT)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="NMHC(GT)"
                    name="NMHC(GT)"
                    required
                  />
                  <span>Hydrocarbures non methaniques</span>
                </div>

                <div class="field">
                  <label for="C6H6(GT)">C6H6(GT)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="C6H6(GT)"
                    name="C6H6(GT)"
                    required
                  />
                  <span>Benzene (C6H6)</span>
                </div>

                <div class="field">
                  <label for="PT08.S2(NMHC)">PT08.S2(NMHC)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="PT08.S2(NMHC)"
                    name="PT08.S2(NMHC)"
                    required
                  />
                  <span>Capteur 2 lie aux NMHC</span>
                </div>

                <div class="field">
                  <label for="NOx(GT)">NOx(GT)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="NOx(GT)"
                    name="NOx(GT)"
                    required
                  />
                  <span>Oxydes d'azote</span>
                </div>

                <div class="field">
                  <label for="PT08.S3(NOx)">PT08.S3(NOx)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="PT08.S3(NOx)"
                    name="PT08.S3(NOx)"
                    required
                  />
                  <span>Capteur 3 pour NOx</span>
                </div>

                <div class="field">
                  <label for="NO2(GT)">NO2(GT)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="NO2(GT)"
                    name="NO2(GT)"
                    required
                  />
                  <span>Dioxyde d'azote</span>
                </div>

                <div class="field">
                  <label for="PT08.S4(NO2)">PT08.S4(NO2)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="PT08.S4(NO2)"
                    name="PT08.S4(NO2)"
                    required
                  />
                  <span>Capteur 4 pour NO2</span>
                </div>

                <div class="field">
                  <label for="PT08.S5(O3)">PT08.S5(O3)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="PT08.S5(O3)"
                    name="PT08.S5(O3)"
                    required
                  />
                  <span>Capteur 5 pour O3 (ozone)</span>
                </div>

                <div class="full-width submit-row">
                  <button type="submit" class="btn-primary">
                    Evaluer la qualite de l'air
                  </button>
                  <div class="hint">
                    Le modele classe le niveau de pollution en Bas, Moyen ou
                    Eleve.
                  </div>
                </div>
              </form>
            </div>

            <div class="card" id="air-result-card" style="display: none">
              <div class="pill">Resultat</div>
              <div id="air-result" class="result" style="margin-top: 1rem">
                <div class="result-title">
                  <div class="result-main">
                    Niveau de pollution :
                    <span id="air-level"></span>
                  </div>
                </div>
                <div
                  id="air-explanation"
                  style="
                    margin-top: 1rem;
                    font-size: 1rem;
                    line-height: 1.6;
                    color: var(--text-muted);
                  "
                >
                </div>
                <div id="air-status" class="status" style="margin-top: 1rem">
                  <div class="status-dot"></div>
                  <span>
                    Niveau de pollution estime a partir des capteurs.
                  </span>
                </div>
              </div>
              <div
                id="air-result-placeholder"
                style="
                  margin-top: 1rem;
                  font-size: 0.86rem;
                  color: var(--text-muted);
                "
              >
                Remplissez les mesures des capteurs puis cliquez sur
                <strong>Evaluer la qualite de l'air</strong> pour voir ici le
                niveau global de pollution.
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer>
        TerraSense - Module qualite de l'air (classification Bas / Moyen /
        Eleve).
      </footer>
    </div>

    <script>
      async function predictAir(formData) {
        const response = await fetch("/predict_air", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        });

        if (!response.ok) {
          throw new Error("Erreur de prediction");
        }

        const result = await response.json();
        if (!result.success) {
          throw new Error(result.error || "Erreur de prediction");
        }

        return result;
      }

      const airForm = document.getElementById("air-form");
      const airResultBox = document.getElementById("air-result");
      const airResultPlaceholder =
        document.getElementById("air-result-placeholder");
      const airLevelEl = document.getElementById("air-level");
      const airExplanationEl = document.getElementById("air-explanation");
      const airStatusEl = document.getElementById("air-status");
      const airFormCard = document.getElementById("air-form-card");
      const airResultCard = document.getElementById("air-result-card");

      const airSteps = document.querySelectorAll("#air-guide-card .wizard-step");
      const airIndicators = [
        document.getElementById("air-indicator-step-1"),
        document.getElementById("air-indicator-step-2"),
        document.getElementById("air-indicator-step-3"),
      ];
      let airCurrentStep = 0;

      function showAirStep(index) {
        airSteps.forEach((step, i) => {
          step.classList.toggle("active", i === index);
        });
        airIndicators.forEach((ind, i) => {
          ind.classList.toggle("active", i <= index);
        });
        airCurrentStep = index;
      }

      document
        .getElementById("air-next-step-1")
        .addEventListener("click", () => showAirStep(1));
      document
        .getElementById("air-next-step-2")
        .addEventListener("click", () => showAirStep(2));
      document
        .getElementById("air-prev-step-2")
        .addEventListener("click", () => showAirStep(0));
      document
        .getElementById("air-prev-step-3")
        .addEventListener("click", () => showAirStep(1));

      document
        .getElementById("air-show-form-button")
        .addEventListener("click", () => {
          airFormCard.style.display = "block";
          window.scrollTo({
            top: airFormCard.offsetTop - 80,
            behavior: "smooth",
          });
        });

      airForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = {};
        [
          "PT08.S1(CO)",
          "NMHC(GT)",
          "C6H6(GT)",
          "PT08.S2(NMHC)",
          "NOx(GT)",
          "PT08.S3(NOx)",
          "NO2(GT)",
          "PT08.S4(NO2)",
          "PT08.S5(O3)",
        ].forEach((name) => {
          formData[name] = airForm[name].value;
        });

        airStatusEl.classList.remove("error");
        airStatusEl.innerHTML =
          '<div class="status-dot"></div><span>Calcul en cours...</span>';
        airResultCard.style.display = "block";
        airResultBox.classList.add("visible");
        airResultPlaceholder.style.display = "none";

        try {
          const result = await predictAir(formData);
          airLevelEl.textContent = result.label;

          const messages = {
            0: "Air globalement bon. Les activites exterieures peuvent se derouler normalement.",
            1: "Qualite de l'air moyenne. Les personnes sensibles peuvent limiter les efforts prolonges en exterieur.",
            2: "Pollution elevee. Evitez les efforts intenses en exterieur et privilegiez les espaces fermes.",
          };

          airExplanationEl.textContent =
            messages[result.class] || result.explanation || "Niveau de pollution estime.";

          airStatusEl.classList.remove("error");
          airStatusEl.innerHTML =
            '<div class="status-dot"></div><span>Interpretez ce niveau pour adapter vos actions (trafic, activites, sensibilisation).</span>';
        } catch (err) {
          airStatusEl.classList.add("error");
          airStatusEl.innerHTML =
            '<div class="status-dot"></div><span style="color:#ef4444">Erreur : ' +
            (err.message || "erreur inconnue") +
            "</span>";
        }
      });
    </script>
  </body>
</html>






